!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("image-decode")):"function"==typeof define&&define.amd?define(["exports","image-decode"],t):t((e||self).imageToAudio={},e.imageDecode)}(this,function(e,t){function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var a=/*#__PURE__*/n(t);function i(){return i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},i.apply(this,arguments)}function r(e,t,n){for(var a=n.length,i=0;i<a;++i)e.setUint8(t+i,n.charCodeAt(i))}var o=/*#__PURE__*/function(){function e(e){this.sampleRate=void 0,this.numChannels=void 0,this.options=void 0,this._dataViews=[],this._numSamples=0,this.options=i({sampleRate:44100,numChannels:1},e),this.sampleRate=this.options.sampleRate,this.numChannels=this.options.numChannels}var t,n,a=e.prototype;return a.encode=function(e){for(var t=e[0].length,n=this.numChannels,a=new DataView(new ArrayBuffer(t*n*2)),i=0,r=0;r<t;++r)for(var o=0;o<n;++o){var s=32767*e[o][r];a.setInt16(i,s<0?Math.max(s,-32768):Math.min(s,32767),!0),i+=2}return this._dataViews.push(a),this._numSamples+=t,a},a.finish=function(e){void 0===e&&(e="audio/wav");var t=this.numChannels*this._numSamples*2,n=new DataView(new ArrayBuffer(44));r(n,0,"RIFF"),n.setUint32(4,36+t,!0),r(n,8,"WAVE"),r(n,12,"fmt "),n.setUint32(16,16,!0),n.setUint16(20,1,!0),n.setUint16(22,this.numChannels,!0),n.setUint32(24,this.sampleRate,!0),n.setUint32(28,4*this.sampleRate,!0),n.setUint16(32,2*this.numChannels,!0),n.setUint16(34,16,!0),r(n,36,"data"),n.setUint32(40,t,!0),this._dataViews.unshift(n);var a=new Blob(this._dataViews,{type:e});return this._dataViews=[],a},a.destory=function(){delete this._dataViews},t=e,(n=[{key:"dataViews",get:function(){return this._dataViews}}])&&function(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,"symbol"==typeof(i=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,"string");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(a.key))?i:String(i),a)}var i}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function s(e,t){for(var n=a.default(e,t),r=[],o=0;o<n.data.length;)r.push(n.data.slice(o,o+=4));return i({},n,{data:r})}function u(e){for(var t=0,n=765*e.length,a=0;a<e.length;a++){var i=e[a];t+=i[0]+i[1]+i[2]}return 2e4*t/n}function l(e,t){var n,a=[];if(t.encodeData)a=t.encodeData(e);else for(var i=0;i<e.width;i++){for(var r=[],o=0;o<e.height;o++)r.push(e.data[o*e.width+i]);a.push(r)}var s=null!=(n=t.encodeFunc)?n:u;return a.map(function(e){return s(e)})}function f(e,t){for(var n=t.seconds,a=[],i=t.sampleRate*n/e.length,r=n/e.length,o=0;o<e.length;o++)for(var s=~~(e[o]*r)*Math.PI*2,u=0;u<i;u++){var l=Math.sin(u/i*s);a.push(l)}return new Float32Array(a)}function h(e,t){var n=i({sampleRate:44100,bpm:60,beat:1/4},t),a=l(s(e,null==n?void 0:n.mimeType),n),r=f(a,{sampleRate:n.sampleRate,seconds:a.length*n.beat/n.bpm*60}),u=new o({sampleRate:n.sampleRate});return u.encode([r]),u.finish()}e.AudioEncoder=o,e.decodeImage=s,e.default=h,e.encodeImage2Freqs=l,e.freqs2AudioData=f,e.imageToAudio=h});
